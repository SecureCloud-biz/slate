<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>dOctobat</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="javascripts/all_nosearch.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["ruby","php"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="https://www.octobat.com/" id="nav-button" target="_blank">
      <span>
        <img src="images/logo_doc.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
        <div class="lang-selector">
              <a href="#" data-language-name="ruby">ruby</a>
              <a href="#" data-language-name="php">PHP</a>
        </div>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Welcome to the <a href="https://www.octobat.com/">Octobat</a> documentation.</p>

<p>We advice you to follow this documentation when subscribing to Octobat.</p>
<h1 id='environment'>Environment</h1>
<p>Please check that you can send us these fields.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>customer_name</td>
<td>Company or individual name</td>
</tr>
<tr>
<td>business_type</td>
<td>B2C or B2B</td>
</tr>
<tr>
<td>eservice</td>
<td>Indicates if you are selling telecommunication, transmission or electronic services</td>
</tr>
<tr>
<td>customer_address</td>
<td>Your customer billing address, must be split into Street, zipcode, city, state and country</td>
</tr>
<tr>
<td>customer_ip_address <strong>optional</strong></td>
<td>The IP address used by the customer to perform the purchase transaction</td>
</tr>
<tr>
<td>customer_vat_number <strong>optional</strong></td>
<td>Your customer registered tax identifier. Mandatory for B2B transactions</td>
</tr>
</tbody></table>
<h1 id='requirements'>Requirements</h1>
<p>To ensure that all your invoices are correctly generated, you must follow this pattern for your Stripe API calls.</p>
<h1 id='customers-amp-cards'>Customers &amp; Cards</h1>
<blockquote>
<p>Add your transaction customer into Stripe</p>
</blockquote>
<pre><code class="highlight ruby"><span class="n">customer</span> <span class="o">=</span> <span class="no">Stripe</span><span class="o">::</span><span class="no">Customer</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
  <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">"foo@bar.io"</span><span class="p">,</span>
  <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">"John Doe Inc."</span><span class="p">,</span>
  <span class="ss">:metadata</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:business_type</span> <span class="o">=&gt;</span> <span class="s2">"B2B"</span><span class="p">,</span>  <span class="c1"># Can be B2B or B2C</span>
    <span class="ss">:vat_number</span> <span class="o">=&gt;</span> <span class="s2">"FR60528551658"</span><span class="p">,</span>
    <span class="ss">:ip_address</span> <span class="o">=&gt;</span> <span class="s2">"87.176.10.2"</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>
<pre><code class="highlight php">$customer = \Stripe\Customer::create(array(
  "email" =&gt; "foo@bar.io",
  "description" =&gt; "John Doe Inc.",
  "metadata" =&gt; array(
    "business_type" =&gt; "B2B", // Can be B2B or B2C
    "vat_number" =&gt; "FR60528551658",
    "ip_address" =&gt; "87.176.10.2"
  )
));
</code></pre>

<blockquote>
<p>Then create a card and fill the required billing data</p>
</blockquote>
<pre><code class="highlight ruby">
<span class="n">card</span> <span class="o">=</span> <span class="n">customer</span><span class="p">.</span><span class="nf">sources</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">source: </span><span class="n">params</span><span class="p">[</span><span class="ss">:stripeToken</span><span class="p">])</span> <span class="c1"># params[:stripeToken] is obtained from Stripe.js</span>

<span class="n">card</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"John Doe"</span>
<span class="n">card</span><span class="p">.</span><span class="nf">address_line1</span> <span class="o">=</span> <span class="s2">"801 Via dei Condotti"</span>
<span class="n">card</span><span class="p">.</span><span class="nf">address_line2</span> <span class="o">=</span> <span class="s2">"Secondo piano"</span>
<span class="n">card</span><span class="p">.</span><span class="nf">address_city</span> <span class="o">=</span> <span class="s2">"Roma"</span>
<span class="n">card</span><span class="p">.</span><span class="nf">address_zip</span> <span class="o">=</span> <span class="s2">"10000"</span>
<span class="n">card</span><span class="p">.</span><span class="nf">address_state</span> <span class="o">=</span> <span class="s2">""</span>
<span class="n">card</span><span class="p">.</span><span class="nf">address_country</span> <span class="o">=</span> <span class="s2">"Italia"</span>
<span class="n">card</span><span class="p">.</span><span class="nf">save</span>
</code></pre>
<pre><code class="highlight php">$card = $customer-&gt;sources-&gt;create(array("source" =&gt; $POST['stripeToken]));

$card-&gt;name = "John Doe";
$card-&gt;address_line1 = "801 Via dei Condotti";
$card-&gt;address_line2 = "Secondo piano";
$card-&gt;address_city = "Roma";
$card-&gt;address_zip = "10000";
$card-&gt;address_state = "";
$card-&gt;address_country = "Italia";
$card-&gt;save();
</code></pre>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>email <strong>required</strong></td>
<td></td>
<td>Your customer email address</td>
</tr>
<tr>
<td>description <strong>required</strong></td>
<td></td>
<td>Your customer name or company name</td>
</tr>
<tr>
<td>business_type <strong>optional</strong></td>
<td>Your setting value in Octobat</td>
<td>B2C/B2B : possible value. This is a required Octobat field to compute the VAT rate for the transaction.</td>
</tr>
<tr>
<td>vat_number <strong>optional</strong></td>
<td>null</td>
<td>Your customer Tax identification number. Mandatory if B2B transaction</td>
</tr>
<tr>
<td>ip_address <strong>optional</strong></td>
<td>null</td>
<td>The IP address of the buyer</td>
</tr>
</tbody></table>
<h1 id='charges'>Charges</h1><pre><code class="highlight ruby"><span class="n">charge</span> <span class="o">=</span> <span class="no">Stripe</span><span class="o">::</span><span class="no">Charge</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
  <span class="ss">:amount</span>      <span class="o">=&gt;</span> <span class="mi">400</span><span class="p">,</span>
  <span class="ss">:currency</span>    <span class="o">=&gt;</span> <span class="s2">"eur"</span><span class="p">,</span>
  <span class="ss">:card</span>        <span class="o">=&gt;</span> <span class="n">card</span><span class="p">,</span>
  <span class="ss">:customer</span>    <span class="o">=&gt;</span> <span class="n">customer</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span>
  <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s1">'One time charge'</span><span class="p">,</span>
  <span class="ss">:metadata</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:eservice</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>
<pre><code class="highlight php">$charge = \Stripe\Charge::create(array(
  "amount"      =&gt; 400,
  "currency"    =&gt; "eur",
  "card"        =&gt; $card,
  "customer"    =&gt; $customer.id,
  "description" =&gt; 'One time charge',
  "metadata" =&gt; array(
    "eservice" =&gt; true
  )
))
</code></pre>

<p><aside class="notice">
If you already know the VAT rate and don&rsquo;t need us to compute it for you, fill the metadata <code class="prettyprint">vat_rate</code> field. Thus, you don&rsquo;t have to fill the customer <code class="prettyprint">business_type</code> and the charge <code class="prettyprint">eservice</code> metadata.
</aside></p>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>description <strong>required</strong></td>
<td></td>
<td>The charge description, and the invoice object.</td>
</tr>
<tr>
<td>vat_rate <strong>optional</strong></td>
<td>Octobat automatic computing</td>
<td>The VAT rate of this charge, if you already know it, and do not want Octobat to compute it for you.</td>
</tr>
<tr>
<td>eservice <strong>optional</strong></td>
<td>Your setting value in Octobat</td>
<td>Will be processed if <code class="prettyprint">business_type</code> equals to &ldquo;B2C&rdquo;. This is a required Octobat field to compute the VAT rate for the transaction.</td>
</tr>
</tbody></table>
<h1 id='subscriptions'>Subscriptions</h1><pre><code class="highlight ruby"><span class="n">customer</span><span class="p">.</span><span class="nf">subscriptions</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
  <span class="ss">:plan</span> <span class="o">=&gt;</span> <span class="s2">"octobat"</span><span class="p">,</span>
  <span class="ss">:metadata</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:eservice</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>
<pre><code class="highlight php">$customer-&gt;subscriptions-&gt;create(array(
  "plan" =&gt; "octobat",
  "metadata" =&gt; array(
    "eservice" =&gt; true
  )
))
</code></pre>

<p>Dealing with subscriptions is like dealing with simple charges, you must fill the metadata field to provide Octobat its required data to generate perfectly your invoices.</p>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>vat_rate <strong>optional</strong></td>
<td>Octobat automatic computing</td>
<td>The VAT rate of this charge, if you already know it, and do not want Octobat to compute it for you.</td>
</tr>
<tr>
<td>eservice <strong>optional</strong></td>
<td>Your setting value in Octobat</td>
<td>Will be processed if <code class="prettyprint">business_type</code> equals to &ldquo;B2C&rdquo;. This is a required Octobat field to compute the VAT rate for the transaction.</td>
</tr>
</tbody></table>
<h1 id='invoice-items'>Invoice items</h1><pre><code class="highlight ruby"><span class="no">Stripe</span><span class="o">::</span><span class="no">InvoiceItem</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
  <span class="ss">:customer</span> <span class="o">=&gt;</span> <span class="n">customer</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span> <span class="c1"># or customer.id</span>
  <span class="ss">:amount</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="ss">:currency</span> <span class="o">=&gt;</span> <span class="s2">"eur"</span><span class="p">,</span>
  <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">"Invoice description"</span><span class="p">,</span>
  <span class="ss">:metadata</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:eservice</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="c1"># or false</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>
<pre><code class="highlight php">Stripe::InvoiceItem.create(
  "customer" =&gt; $customer.id, # or customer.id
  "amount" =&gt; 1000,
  "currency" =&gt; "eur",
  "description" =&gt; "Invoice description",
  "metadata" =&gt; array(
    "eservice" =&gt; true # or false
  )
)
</code></pre>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>vat_rate <strong>optional</strong></td>
<td>Octobat automatic computing</td>
<td>The VAT rate of this charge, if you already know it, and do not want Octobat to compute it for you.</td>
</tr>
<tr>
<td>eservice <strong>optional</strong></td>
<td>Your setting value in Octobat</td>
<td>Will be processed if <code class="prettyprint">business_type</code> equals to &ldquo;B2C&rdquo;. This is a required Octobat field to compute the VAT rate for the transaction.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="ruby">ruby</a>
                <a href="#" data-language-name="php">PHP</a>
          </div>
      </div>
    </div>
  </body>
</html>
